<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <!-- <meta name="theme-color" content="#4d394b"> -->
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1.0,user-scalable=no">
    <title>Workout Land</title>
    <link rel="icon" href="img/icon.png">
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,900,400italic,700italic,900italic' rel='stylesheet' type='text/css'>

    <script>
      window.isApp = /^file/.test(location.protocol);
      window.isLocalhost = '3000' == location.port;
      window.website = 'workout.land';
      navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate;

      function updateSettings() {
        if (!window.settings) {
          window.settings = JSON.parse(localStorage.settings || JSON.stringify({
            unit: 'kg',
            keepAwake: true,
            TTS: true,
            voiceControl: true,
            TTSUpNext: true,
            vibrate: true
          }));
        } else {
          localStorage.settings = window.settings ?
            JSON.stringify(window.settings) :
            JSON.stringify({
              unit: 'kg',
              keepAwake: true,
              TTS: true,
              vibrate: true
            });
        }
      }

      updateSettings();

      document.write(isApp ? '' : '\<base href=\"/\"\>')
      document.write((isApp || isLocalhost ? [
        'bower_components/angular/angular.min.js',
        'bower_components/jquery/dist/jquery.min.js',
        'bower_components/fastclick/lib/fastclick.js',
        'bower_components/angular-ui-router/release/angular-ui-router.min.js',
        'bower_components/angular-sanitize/angular-sanitize.min.js',
        'bower_components/allmighty-autocomplete/script/autocomplete.js',
        'bower_components/annyang/annyang.min.js',
        'js/create.js',
        'js/workout.js',
        'js/gold.js',
        'js/workouts.js',
        'js/app.js',
        'cordova.js'
      ] : [
        'https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js',
        'https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js',
        'https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.14/angular-ui-router.min.js',
        'https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-sanitize.js',
        'https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js',
        'https://cdnjs.cloudflare.com/ajax/libs/annyang/1.6.0/annyang.min.js',
        'bower_components/allmighty-autocomplete/script/autocomplete.js',
        'js/create.js',
        'js/workout.js',
        'js/gold.js',
        'js/workouts.js',
        'js/app.js'
      ]).map(function(s) {
        return '\<script src=\"' + s + '\"\>\<\/script\>';
      }).join(''))
    </script>
    <script src="https://checkout.stripe.com/checkout.js"></script>

    <script>
      if (!isApp) {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-51793300-5', 'auto');
        ga('send', 'pageview');
      }
    </script>

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/open-sans.css">
    <link rel="stylesheet" href="fonts/icomoon/style.css">
  </head>
  <body>
    <div class="nav nav-top">
      <div class="nav-inner logo-nav">
        <div id="container">
          <a wl-href="/c">CREATE</a>
          <a wl-href="/">WORKOUTS</a>
        </div>
      </div>
    </div>
    <div id="view">
      <script>
        if (!isApp) {
          document.write([
          '<table class="grid" style="padding-top: 1rem; width: 100%;">',
            '<tr>',
              '<td class="text-right" style="vertical-align: middle;">',
                '<a href="https://play.google.com/store/apps/details?id=com.andrewmilson.workoutland">',
                  '<img src="img/play-store.svg" style="margin-right: 0.5rem; height: 1.6rem;" alt=""><br>',
                  '<img src="img/app-store.svg" style="margin-right: 0.5rem; height: 1.6rem;" alt="">',
                '</a>',
              '</td>',
              '<td style="vertical-align: middle; font-weight: 800; font-size: 0.7rem">',
                '<div>Offline workouts!</div>',
                '<div>HD text to speech!</div>',
                '<div>Smartwatch app!</div>',
              '</td>',
            '</tr>',
          '</table>',
          '<hr>'].join(''));
        }
      </script>
      <div ui-view autoscroll="false"></div>
    </div>
    <script>
      if (!isApp && !window.speechSynthesis) {
        document.write('\<script src=\"js/mespeak.js\"\>\<\/script\>')
      }
    </script>
    <script>
      $(function() {
        FastClick.attach(document.body);
      });

      function loadJS(fimeName){
        var script = document.createElement('script')
        script.setAttribute("src", fimeName)
        document.getElementsByTagName("head")[0].appendChild(script)
      }

      function bootstrapAngular() {
        angular.bootstrap(document.body, ['workoutland']);
      }

      if (isApp) {
        document.addEventListener('deviceready', function() {
          // cordova.plugins.backgroundMode.enable();

          if (cordova.platformId == 'android') {
            StatusBar.backgroundColorByHexString('#582A87');

            if(AndroidWear) {
              AndroidWear.onConnect(function(e) {
                window.androidWearConnected = true;
              });
            }
          }

          bootstrapAngular()
          window.webintent.getUri(function(uri) {
            if (!/^http/.test(uri)) return;
            var workoutId = /^(?:[^\/]*(?:\/(?:\/[^\/]*\/?)?)?([^?]+)(?:\??.+)?)$/.exec(uri)[1];
            window.location.replace('#/' + workoutId);
          }, false);
        });
      } else {
        bootstrapAngular();
        if (!window.speechSynthesis) {
          meSpeak.loadConfig("js/mespeak_config.json");
          meSpeak.loadVoice('js/en-us.json');
        }
      }
    </script>
  </body>
</html>
