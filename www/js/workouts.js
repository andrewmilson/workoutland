angular.module('workoutsController', [])

.controller('workoutsController',
['$scope', '$timeout', '$state', '$http',
function($scope, $timeout, $state, $http) {
  $scope.workouts = [];
  if (!~Object.keys(localStorage).join('').indexOf('workout')) {
    localStorage['workout-1sFTwe'] = '{"sample":true,"notes":"Workout based on Brandon Carter\'s video https://www.youtube.com/watch?v=Pw6hViAT6Qk","steps":[{"reps":0,"name":"Iron butterflies","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Rest","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Flutter kicks","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Rest","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Windmills","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Rest","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"V-ups","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Rest","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Left side plank dips","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Rest","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Right side plank dips","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Rest","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Iron butterflies","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Plank","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Flutter kicks","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Plank","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Windmills","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Plank","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"V-ups","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Plank","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Left side plank dips","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Plank","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Right side plank dips","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Rest","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Iron butterflies","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Mountain climbers","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Flutter kicks","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Mountain climbers","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Windmills","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Mountain climbers","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"V-ups","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Mountain climbers","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Left side plank dips","weight":0,"time":20,"displayReps":0,"displayTime":20},{"reps":0,"name":"Mountain climbers","weight":0,"time":10,"displayReps":0,"displayTime":10},{"reps":0,"name":"Right side plank dips","weight":0,"time":20,"displayReps":0,"displayTime":20}],"id":"1sFTwe","name":"Calisthenics abdominal assault","difficulty":1,"time":550,"stepDifficulty":[]}'
    localStorage['workout-BJ6ddg'] = '{"sample":true,"name":"Bar Brothers triceps workout","notes":"CHALLENGE A FRIEND - http://www.BarBrothersDC.com","steps":[{"$$hashKey":"object:483","name":"Impossible dips","reps":10},{"$$hashKey":"object:489","name":"Rest","time":180},{"$$hashKey":"object:495","name":"Impossible dips","time":null,"reps":10},{"$$hashKey":"object:501","name":"Rest","time":180},{"$$hashKey":"object:507","name":"Impossible dips","time":null,"reps":10},{"$$hashKey":"object:513","name":"Rest","time":180},{"$$hashKey":"object:519","name":"Impossible dips","reps":10},{"$$hashKey":"object:525","name":"Rest","time":90},{"$$hashKey":"object:531","name":"Impossible push ups","reps":15},{"$$hashKey":"object:537","name":"Rest","time":180},{"$$hashKey":"object:543","name":"Impossible push ups","reps":15},{"$$hashKey":"object:549","name":"Rest","time":180},{"$$hashKey":"object:555","name":"Impossible push ups","reps":15},{"$$hashKey":"object:561","name":"Rest","time":180},{"$$hashKey":"object:567","name":"Impossible push ups","reps":15},{"$$hashKey":"object:573","name":"Rest","time":90},{"$$hashKey":"object:619","name":"One arm (left) push ups","reps":7},{"$$hashKey":"object:625","name":"One arm (right) push ups","reps":7},{"$$hashKey":"object:631","name":"Rest","time":180},{"$$hashKey":"object:638","name":"One arm (left) push ups","reps":7},{"$$hashKey":"object:644","name":"One arm (right) push ups","reps":7},{"$$hashKey":"object:653","name":"Rest","time":180},{"$$hashKey":"object:659","name":"One arm (left) push ups","reps":7},{"$$hashKey":"object:665","name":"One arm (right) push ups","reps":7},{"$$hashKey":"object:671","name":"Rest","time":90},{"$$hashKey":"object:677","name":"Low bar overhead tricep extensions","reps":20},{"$$hashKey":"object:683","name":"Rest","time":180},{"$$hashKey":"object:690","name":"Low bar overhead tricep extensions","reps":20},{"$$hashKey":"object:696","name":"Rest","time":180},{"$$hashKey":"object:702","name":"Low bar overhead tricep extensions","reps":20},{"$$hashKey":"object:708","name":"Rest","time":180},{"$$hashKey":"object:714","name":"Low bar overhead tricep extensions","reps":20},{"$$hashKey":"object:720","name":"Rest","time":180},{"$$hashKey":"object:726","name":"Low bar overhead tricep extensions","reps":20},{"$$hashKey":"object:732","name":"Rest","time":90},{"$$hashKey":"object:738","name":"100 diamond push ups","time":180}],"id":"BJ6ddg","unit":"kg"}';
  }

  for (var key in localStorage) {
    if (~key.indexOf('workout-')) {
      $scope.workouts.push(JSON.parse(localStorage[key]))
      var workout = $scope.workouts.slice(-1)[0];
      workout.time = 0;
      workout.steps.map(function(a) {
        if (a.time < 0 || a.reps < 0) {
          a.toFailure = true;
        } else {
          a.time = a.time || 0;
          a.reps = a.reps || 0;
        }

        workout.time += (a.toFailure && 30) || a.time || a.reps * 5 + 20;
      });
      workout.time = Math.floor(workout.time);
    }
  }

  $scope.workouts.reverse();
}]);
